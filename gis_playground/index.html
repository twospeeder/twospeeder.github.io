<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <script src="https://js.arcgis.com/4.5/"></script>

        <link rel="stylesheet" href="https://js.arcgis.com/4.5/esri/css/main.css" />
        <link rel="stylesheet" href="https://js.arcgis.com/4.5/dijit/themes/nihilo/nihilo.css" />
        <link rel="stylesheet" href="css/main.css" />

        <script>
            require([
                "esri/Map",
                "esri/tasks/Locator",
                "esri/views/MapView",
                "esri/widgets/BasemapToggle",
                "dojo/domReady!"
            ], function(Map, Locator, MapView, BasemapToggle) {

                var locatorTask = new Locator({
                    url: "https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"
                });

                var map = new Map({
                    basemap: "topo"
                });

                var view = new MapView({
                    container: "viewDiv", //DOM node that will contain the view
                    map: map,
                    center: [-105.07, 40.6],
                    zoom: 3
                });

                var toggle = new BasemapToggle({
                    view: view,
                    nextBasemap: "hybrid"
                });

                view.ui.add(toggle, "top-right");                

                view.on("click", function(evt) {
                    evt.stopPropagation();

                    //get coordinates of click
                    var lat = Math.round(evt.mapPoint.latitude * 1000) / 1000;
                    var lon = Math.round(evt.mapPoint.longitude * 1000) / 1000;

                    view.popup.open({
                        //set the title to coordinates of clicked location
                        title: "Reverse geocode: [" + lon + ", " + lat + "]",
                        location: evt.mapPoint //set at clicked location
                    });

                    locatorTask.locationToAddress(evt.mapPoint).then(function(response) {
                        view.popup.content = response.address;
                    }).otherwise(function(err) {
                        view.popup.content = "No address found for this location";
                    });
                });
            });
        </script>

        <title></title>
    </head>
    <body class="nihilo">
        <div id="viewDiv"></div>
    </body>
</html>
